<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      html,
      body {
        overflow-x: hidden;
        height: 100vh;
      }
      .card-box img {
        height: 300px;
        width: 500px;
        border-radius: 20px;
        margin: 20px 0;
      }
      .button {
        margin-bottom: 10px;
      }
    </style>
  </head>
  <% layout("/layouts/boilerplate") %>
  <body>
    <div class="offset-3 w-50">
      <div class="card-box">
        <h1><%= data.title %></h1>

        <img src="<%= data.image.url %>" alt="<%= data.title %>" />
        <p>username: <b><%= data.user.username %></b></p>
        <p>description : <%= data.description %></p>
        <p>price: &#x20B9;<%= data.price.toLocaleString("en-IN") %></p>
        <p>location : <%= data.location %></p>
        <p>country: <%= data.country %></p>
      </div>
      <div class="edit-btn">
        <form method="get" action="/listing/<%= data.id %>/edit">
          <div class="button-1">
            <button type="submit" class="btn btn-outline-dark">
              Edit this listing
            </button>
          </div>
        </form>

        <form method="post" action="/listing/<%= data.id %>?_method=DELETE">
          <div class="button">
            <button type="submit" class="btn btn-outline-dark">DELETE</button>
          </div>
        </form>

        <form method="get" action="/listing">
          <div class="button">
            <button type="submit" class="btn btn-outline-dark">Back</button>
          </div>
        </form>
      </div>
    </div>
    <div class="border-top border-dark">
      <% if(currUser) {%>
      <div class="offset-3">
       
        <form
          action="/listing/<%= data.id %>/review"
          method="POST"
          novalidate
          class="needs-validation"
        >
         
          </div> 
           <h1>Leave a review</h1>
          <fieldset class="starability-slot">
            <legend>First rating:</legend>
            <input
              type="radio"
              id="no-rate"
              class="input-no-rate"
              name="review[rating]"
              value="1"
              checked
              aria-label="No rating."
            />
            <input type="radio" id="first-rate1" name="review[rating]" value="1" />
            <label for="first-rate1" title="Terrible">1 star</label>
            <input type="radio" id="first-rate2" name="review[rating]" value="2" />
            <label for="first-rate2" title="Not good">2 stars</label>
            <input type="radio" id="first-rate3" name="review[rating]" value="3" />
            <label for="first-rate3" title="Average">3 stars</label>
            <input type="radio" id="first-rate4" name="review[rating]" value="4" />
            <label for="first-rate4" title="Very good">4 stars</label>
            <input type="radio" id="first-rate5" name="review[rating]" value="5" />
            <label for="first-rate5" title="Amazing">5 stars</label>
          </fieldset>
          <div class="mt-3 mb-3">
            <label for="comment">Comment</label>
            <textarea
              type="text"
              name="review[comment]"
              id="comment"
              cols="5"
              rows="5"
              class="form-control"
              required
            ></textarea>
            <div class="invalid-feedback">
              Please add some comment for review.
            </div>
          </div>
          <div style="margin-top: 20px; margin-bottom: 20px">
            <button class="btn btn-outline-dark">submit</button>
          </div>
        </form>
        <% } %>
        <hr />
        <h4>All Reviews</h4>
        <div class="row mb-3">
          <% for(review of data.review) {%>
          <div class="card-review col-5 mt-3 ms-3">
            <div class="card-body">
              <h5 class="card-title">@<%= review.author.username %></h5>
              <p class="starability-result" data-rating="<%= review.rating %>"></p>
              <p class="card-text"><%= review.comment %></p>
              
              
            </div>
            <form
              method="post"
              action="/listing/<%= data.id %>/review/<%= review.id %>?_method=DELETE"
            >
              <button class="btn btn-sm btn-outline-dark"><b>DELETE</b></button>
            </form>
          </div>
          <% } %>
        </div>
      </div>
    </div>
    <script src="/js/script.js"></script>
  </body>
</html>
